

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Code Review #2 - Stock Data EDA &#8212; Implementing Autoencoder asset pricing model in korean stock market</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/5.Stock_Data_EDA';</script>
    <link rel="shortcut icon" href="../_static/Felab_logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Code Review #1 - Build Stock Dataset" href="4.build_stock_dataset.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/Felab_logo2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/Felab_logo2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">이론적 배경</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.basic_CAPM.html">Capital Asset Pricing Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.basic_fama.html">Fama-French Three-Factor Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Autoencoder Asset Pricing Model</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="3.paper_review.html">Paper Review - Autoencoder Asset Pricing Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.build_stock_dataset.html">Code Review #1 - Build Stock Dataset</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Code Review #2 - Stock Data EDA</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FELAB-KHU/Asset-pricing-models-using-deep-learning-networks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FELAB-KHU/Asset-pricing-models-using-deep-learning-networks/issues/new?title=Issue%20on%20page%20%2Fdocs/5.Stock_Data_EDA.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/5.Stock_Data_EDA.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Code Review #2 - Stock Data EDA</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1. 데이터 불러오기</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prices-metadata">Prices, Metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select-tickers-with-metadata">Select tickers with metadata</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-engineering">Factor Engineering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#price-trend">Price Trend</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#short-term-reversal">Short-Term Reversal</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-momentum">Stock Momentum</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#momentum-change">Momentum Change</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#industry-momentum">Industry Momentum</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recent-max-return">Recent Max Return</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#long-term-reversal">Long-Term Reversal</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#liquidity-metrics">Liquidity Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#turnover">Turnover</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#turnover-volatility">Turnover Volatility</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-market-equity">Log Market Equity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#krw-volume">KRW Volume</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#amihud-illiquidity">Amihud Illiquidity</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-measures">Risk Measures</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#return-volatility">Return Volatility</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#market-beta">Market Beta</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#beta-squared">Beta Squared</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#idiosyncratic-return-volatility">Idiosyncratic return volatility</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="code-review-2-stock-data-eda">
<h1>Code Review #2 - Stock Data EDA<a class="headerlink" href="#code-review-2-stock-data-eda" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.regression.rolling</span> <span class="kn">import</span> <span class="n">RollingOLS</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>

<span class="n">results_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;KR2_results&#39;</span><span class="p">,</span> <span class="s1">&#39;asset_pricing&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">results_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">results_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h2>1. 데이터 불러오기<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<section id="prices-metadata">
<h3>Prices, Metadata<a class="headerlink" href="#prices-metadata" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;data.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;stocks/prices/adjusted&#39;</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;data.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;stocks/info&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>address1</th>
      <th>address2</th>
      <th>city</th>
      <th>zip</th>
      <th>country</th>
      <th>phone</th>
      <th>fax</th>
      <th>website</th>
      <th>industry</th>
      <th>sector</th>
      <th>...</th>
      <th>freecashflow</th>
      <th>operatingcashflow</th>
      <th>earningsgrowth</th>
      <th>revenuegrowth</th>
      <th>grossmargins</th>
      <th>ebitdamargins</th>
      <th>operatingmargins</th>
      <th>financialcurrency</th>
      <th>trailingpegratio</th>
      <th>openinterest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>005930.KS</th>
      <td>129 Samsung-Ro</td>
      <td>Maetan-3dong Yeongtong-gu</td>
      <td>Suwon-si</td>
      <td>443-742</td>
      <td>South Korea</td>
      <td>82 2 2255 0114</td>
      <td>82 3 1200 7538</td>
      <td>https://www.samsung.com</td>
      <td>Consumer Electronics</td>
      <td>Technology</td>
      <td>...</td>
      <td>-1.345999e+13</td>
      <td>5.205390e+13</td>
      <td>-0.859</td>
      <td>-0.223</td>
      <td>0.31972</td>
      <td>0.19889</td>
      <td>0.06076</td>
      <td>KRW</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>373220.KS</th>
      <td>108, Yeoui-daero</td>
      <td>Yeongdeungpo-Gu</td>
      <td>Seoul</td>
      <td>07335</td>
      <td>South Korea</td>
      <td>82 2 3777 1114</td>
      <td>NaN</td>
      <td>https://www.lgensol.com</td>
      <td>Specialty Industrial Machinery</td>
      <td>Industrials</td>
      <td>...</td>
      <td>-6.875540e+12</td>
      <td>1.267587e+12</td>
      <td>3.593</td>
      <td>0.730</td>
      <td>0.15789</td>
      <td>0.10627</td>
      <td>0.04871</td>
      <td>KRW</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>000660.KS</th>
      <td>2091 Gyeongchung-daero</td>
      <td>Bubal-eup</td>
      <td>Icheon-Si</td>
      <td>NaN</td>
      <td>South Korea</td>
      <td>82 31 5185 4114</td>
      <td>NaN</td>
      <td>https://www.skhynix.com</td>
      <td>Semiconductors</td>
      <td>Technology</td>
      <td>...</td>
      <td>-8.570626e+12</td>
      <td>4.371575e+12</td>
      <td>NaN</td>
      <td>-0.471</td>
      <td>0.03433</td>
      <td>0.23260</td>
      <td>-0.21051</td>
      <td>KRW</td>
      <td>0.621</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>207940.KS</th>
      <td>300, Songdo Bio-daero</td>
      <td>Yeonsu-gu</td>
      <td>Incheon</td>
      <td>21987</td>
      <td>South Korea</td>
      <td>82 3 2455 3114</td>
      <td>NaN</td>
      <td>https://samsungbiologics.com</td>
      <td>Biotechnology</td>
      <td>Healthcare</td>
      <td>...</td>
      <td>-5.206233e+11</td>
      <td>1.297787e+12</td>
      <td>0.207</td>
      <td>0.330</td>
      <td>0.49948</td>
      <td>0.42886</td>
      <td>0.31606</td>
      <td>KRW</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>005490.KS</th>
      <td>6261, Donghaean-ro</td>
      <td>Nam-gu</td>
      <td>Pohang</td>
      <td>NaN</td>
      <td>South Korea</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>https://www.posco.com</td>
      <td>Steel</td>
      <td>Basic Materials</td>
      <td>...</td>
      <td>3.865827e+11</td>
      <td>8.028374e+12</td>
      <td>-0.530</td>
      <td>-0.126</td>
      <td>0.06718</td>
      <td>0.07870</td>
      <td>0.03133</td>
      <td>KRW</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 109 columns</p>
</div></div></div>
</div>
</section>
<section id="select-tickers-with-metadata">
<h3>Select tickers with metadata<a class="headerlink" href="#select-tickers-with-metadata" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sectors</span> <span class="o">=</span> <span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">sector</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">tickers_with_errors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">tickers_with_metadata</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">sector</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sectors</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">marketcap</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
    <span class="o">&amp;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">sharesoutstanding</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">sharesoutstanding</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">tickers_with_errors</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">tickers_with_metadata</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sector&quot;</span><span class="p">,</span> <span class="s2">&quot;sharesoutstanding&quot;</span><span class="p">,</span> <span class="s2">&quot;marketcap&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">metadata</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ticker&quot;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>메타데이터에서 9회 이상 카운트된 섹터만 선택합니다.</p></li>
<li><p>메타데이터의 오류를 검정합니다. 아래의 경우는 <code class="docutils literal notranslate"><span class="pre">drop</span></code>합니다.</p>
<ul>
<li><p>섹터가 없는 경우</p></li>
<li><p>시가총액이 없는 경우</p></li>
<li><p>발행주식수가 없는 경우</p></li>
<li><p>발행주식수가 0인 경우</p></li>
</ul>
</li>
<li><p>메타데이터를 다시 수정합니다.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if &#39;tickers_with_metadata&#39; contains valid tickers in &#39;prices&#39; DataFrame</span>
<span class="n">valid_tickers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">prices</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;ticker&quot;</span><span class="p">))</span>
<span class="n">tickers_with_metadata</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ticker</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers_with_metadata</span> <span class="k">if</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">valid_tickers</span>
<span class="p">]</span>

<span class="c1"># Use .loc to select rows based on the tickers_with_metadata list</span>
<span class="n">prices</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span><span class="p">[</span><span class="n">tickers_with_metadata</span><span class="p">,</span> <span class="p">:],</span> <span class="p">:]</span> <span class="c1"># type: ignore</span>
</pre></div>
</div>
</div>
</div>
<p>가격 데이터도 수정된 메타데이터를 이용하여 다시 슬라이싱을 통해 수정합니다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">close</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s2">&quot;ticker&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s2">&quot;ticker&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">returns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">prices</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s2">&quot;ticker&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;W-FRI&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">last</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
    <span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s2">&quot;autoencoder.h5&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="n">close</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;returns&quot;</span><span class="p">,</span> <span class="n">returns</span><span class="p">)</span>
    <span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>수정된 가격 데이터를 이용하여 <code class="docutils literal notranslate"><span class="pre">close</span></code>와 <code class="docutils literal notranslate"><span class="pre">volume</span></code>을 정의합니다. <code class="docutils literal notranslate"><span class="pre">return</span></code> 데이터는 <code class="docutils literal notranslate"><span class="pre">close</span></code>를 이용하여 주간 수익률로 정의합니다. 이러한 데이터를 <code class="docutils literal notranslate"><span class="pre">autoencoder.h5</span></code>에 저장하면서 이후 모델에 사용할 수 있도록 합니다.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;ticker&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;date&#39;, ylabel=&#39;ticker&#39;&gt;
</pre></div>
</div>
<img alt="../_images/0e99c7b9f5de029722fb900bf3240614b47b5c8778fe31702f767cdde0fc68c3.png" src="../_images/0e99c7b9f5de029722fb900bf3240614b47b5c8778fe31702f767cdde0fc68c3.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">return</span></code>이 NaN이 아닌 Ticker 개수를 날짜를 기준으로 데이터를 시각화했습니다. 특정 시점에 주식 종목 수가 Discrete하게 증가하는 것을 확인할 수 있습니다. 사후 검증 결과 yfinance 데이터의 문제로 확인되었습니다. 해당 시점에 KOSPI 시장에서에 어떤 이벤트가 있을 것으로 예상했지만 다른 라이브러리로 확인한 결과 해당 시점에는 이벤트가 없었습니다. 해당 오류를 배제하기 위해서는 해당 시점의 데이터를 사용하지 않거나 다른 라이브러리를 사용하여 데이터를 불러와야 합니다. 그러나 yfinacne처럼 편하게 메타데이터를 받을 수 있는 라이브러리를 아직 찾지 못했습니다. 또한, 해당 시점을 추가하더라도 모델에 큰 영향을 주지 않는 것으로 확인되었습니다. 이러한 이슈가 있었다는 것을 참고차 언급하고 넘어가겠습니다.</p>
</section>
</section>
<section id="factor-engineering">
<h2>Factor Engineering<a class="headerlink" href="#factor-engineering" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MONTH</span> <span class="o">=</span> <span class="mi">21</span>
</pre></div>
</div>
</div>
</div>
<p>한 달은 주 거래일 기준으로 21일로 정의합니다.</p>
<table><tr>
<td> <p align="center"><img src="../images/Firm_Characteristics.png"/></p> </td>
<td> <p align="center"><img src="../images/Firm_Characteristics_2.png"/></p> </td>
</tr></table><p>팩터 엔지니어링은 위 그림과 같이 진행합니다. 크게 4개의 특성으로 분류할 수 있습니다. <code class="docutils literal notranslate"><span class="pre">Price</span> <span class="pre">Trend</span></code>, <code class="docutils literal notranslate"><span class="pre">Liquidity</span> <span class="pre">Metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">Risk</span> <span class="pre">Measures</span></code>, <code class="docutils literal notranslate"><span class="pre">Meta</span> <span class="pre">Data</span></code>입니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">Price</span> <span class="pre">Trend</span></code>는 가격의 변동성을 봅니다. 예를 들어 <code class="docutils literal notranslate"><span class="pre">Momentum</span></code>(모멘텀)이나 <code class="docutils literal notranslate"><span class="pre">Reversal</span></code>(리버설) 전략 등이 있습니다. 간단하게 모멘텀은 ‘오르는 주식은 계속 오르고, 내리는 주식은 계속 내릴 것이다.’라는 것이고, 리버설은 ‘오르는 주식은 내릴 것이고, 내리는 주식은 오를 것이다.’로 요약할 수 있습니다. 또 산업군 별로 주식들을 그룹을 지어 산업군 내의 모멘텀을 보기도 합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">Liquidity</span> <span class="pre">Metrics</span></code>는 <code class="docutils literal notranslate"><span class="pre">Turnover</span></code>(매매 회전율), <code class="docutils literal notranslate"><span class="pre">Turnover</span> <span class="pre">Volatility</span></code>(매매 회전율의 변동성)과 같은 시장 유동성 지표를 의미합니다. <code class="docutils literal notranslate"><span class="pre">Amihud</span> <span class="pre">Illiquidity</span></code>는 거래량 대비 일일 절대 수익률 비율을 뜻하는 Metric입니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">Risk</span> <span class="pre">Measures</span></code>는 주식의 리스크를 측정하는 지표입니다. 수익률의 변동성이 커지면 해당 시장에 어떠한 리스크가 존재한다는 것이고, <code class="docutils literal notranslate"><span class="pre">Beta</span></code>는 주식의 시장 대비 상대적인 변동성을 의미합니다. <code class="docutils literal notranslate"><span class="pre">idiosysncratic</span> <span class="pre">return</span> <span class="pre">volatility</span></code>(특이 수익률의 변동성)이 커지면 설명할 수 없거나 예상할 수 없는 큰 수익률이 높아진 것이므로 해당 시장의 위험이 커졌다고 볼 수 있습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">Meta</span> <span class="pre">Data</span></code>는 <code class="docutils literal notranslate"><span class="pre">Return</span></code>으로 여러 팩터들을 이용하여 우리가 예측해야 할 종속 변수에 해당합니다. 이제 코드를 살펴보겠습니다.</p>
<section id="price-trend">
<h3>Price Trend<a class="headerlink" href="#price-trend" title="Permalink to this heading">#</a></h3>
<section id="short-term-reversal">
<h4>Short-Term Reversal<a class="headerlink" href="#short-term-reversal" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1-month cumulative return</span>
<span class="n">mom1m</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">MONTH</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;W-FRI&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;mom1m&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="n">mom1m</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s2">&quot;autoencoder.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;factor/mom1m&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://quantpedia.com/strategies/short-term-reversal-in-stocks">Short-Term Reversal</a>입니다. 1개월 수익률을 계산합니다. 링크를 눌러 해당 전략에 대한 자세한 설명을 참고하세요.</p>
<p><code class="docutils literal notranslate"><span class="pre">Short-Term</span> <span class="pre">Reversal</span></code>은 극단적인 상승 또는 하락 움직임 이후 단기적으로 반전하는 자산의 경향을 활용하는 금융 트레이딩 접근법입니다. 이 전략은 단기간에 큰 폭의 상승 또는 하락을 경험한 종목을 찾아내어 단기적으로 평균 또는 평균 수익률로 되돌아갈 것으로 예상하는 것입니다. 이 전략을 사용하는 트레이더는 일반적으로 최근 상승한 종목을 매도하고 최근 하락한 종목을 매수하여 반전을 기대합니다. 이는 행동주의 금융에 뿌리를 두고 있으며, 이러한 단기 추세를 시장의 과민 반응과 그에 따른 조정으로 보고 수익 기회를 제공합니다. 그러나 이 전략은 위험할 수 있고 타이밍과 시장 상황에 따라 크게 달라질 수 있으므로 투자자는 위험 관리 기법을 사용하는 것이 필수적입니다.</p>
</section>
<section id="stock-momentum">
<h4>Stock Momentum<a class="headerlink" href="#stock-momentum" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 11-month cumulative returns ending 1-month before month end</span>
<span class="n">mom12m</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">11</span> <span class="o">*</span> <span class="n">MONTH</span><span class="p">)</span>
    <span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span>
    <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;W-FRI&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">last</span><span class="p">()</span>
    <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
    <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;mom12m&quot;</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="n">mom12m</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/mom12m&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://quantpedia.com/strategies/momentum-factor-effect-in-stocks/">Stock Momentum</a>입니다. 최근 1개월 수익률을 제외하고 12개월의 누적 수익률을 계산합니다. 링크를 눌러 해당 전략에 대한 자세한 설명을 참고하세요.</p>
<p><code class="docutils literal notranslate"><span class="pre">Stock</span> <span class="pre">Momentum</span></code>은 주식의 가격 움직임에 기반을 둔 것으로, 특정 주식이 최근에 강한 상승 또는 하락 추세를 보이면 이러한 추세가 지속될 것이라는 기대에 따라 투자 결정을 내리는 방법입니다. 위 설명에서 언급된 “최근 1개월 수익률을 제외하고 12개월의 누적 수익률을 계산”하는 방법은, 최근 한 달 동안의 주식의 수익률을 무시하고 그 이전 12개월 동안의 수익률을 기반으로 주식의 모멘텀을 평가하는 방법입니다. 이러한 접근 방식은 최근의 장기적인 가격 추세를 파악하고, 단기적인 변동성이나 노이즈를 배제하여 더욱 정확한 투자 결정을 돕기 위함입니다. 이러한 모멘텀 전략은 주로 중기적인 시각에서 주식을 보유하는 투자자들에게 인기가 있으며, 적절한 리스크 관리와 함께 사용될 때 높은 수익을 가져올 수 있는 잠재력이 있습니다.</p>
</section>
<section id="momentum-change">
<h4>Momentum Change<a class="headerlink" href="#momentum-change" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cumulative return from months t-6 to t-1 minus months t-12 to t-7.</span>
<span class="n">chmom</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span>
         <span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">6</span> <span class="o">*</span> <span class="n">MONTH</span><span class="p">)</span>
         <span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">6</span> <span class="o">*</span> <span class="n">MONTH</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">MONTH</span><span class="p">))</span>
         <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
         <span class="o">.</span><span class="n">last</span><span class="p">()</span>
         <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
         <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;chmom&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">chmom</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/chmom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Momentum</span> <span class="pre">Change</span></code>은 주식의 가격 변동성과 기존의 모멘텀을 결합하여 중간기간의 주식 가격의 변화를 측정하는 방법입니다. 이 전략은 <code class="docutils literal notranslate"><span class="pre">Cumulative</span> <span class="pre">return</span> <span class="pre">from</span> <span class="pre">months</span> <span class="pre">t-6</span> <span class="pre">to</span> <span class="pre">t-1</span> <span class="pre">minus</span> <span class="pre">months</span> <span class="pre">t-12</span> <span class="pre">to</span> <span class="pre">t-7</span></code>을 사용하여 주식의 모멘텀의 변화를 측정합니다. 이 계산을 통해 최근의 가격 변화가 지난 몇 개월 동안의 추세에 비해 어떻게 변화하고 있는지를 파악하게 됩니다.</p>
<p>예를 들어, 최근 6개월 동안의 누적 수익률이 높고 그 이전의 6개월 동안의 누적 수익률이 낮을 경우, 이는 주식의 모멘텀이 증가하고 있다는 신호로 해석될 수 있습니다. 반대로, 최근 6개월 동안의 누적 수익률이 낮고 그 이전의 6개월 동안의 누적 수익률이 높을 경우, 이는 모멘텀이 감소하고 있다는 신호로 해석될 수 있습니다. 이러한 정보를 바탕으로 투자자는 주식을 매수 또는 매도하는 결정을 내릴 수 있으며, 이런 방식으로 모멘텀의 변화를 활용하여 투자 기회를 포착할 수 있습니다.</p>
</section>
<section id="industry-momentum">
<h4>Industry Momentum<a class="headerlink" href="#industry-momentum" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Equal-weighted avg. industry 12-month returns</span>
<span class="n">indmom</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">MONTH</span><span class="p">)</span>
          <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">last</span><span class="p">()</span>
          <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
          <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
          <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata</span><span class="p">[[</span><span class="s1">&#39;sector&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;sector&#39;</span><span class="p">])</span>
          <span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
          <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;indmom&#39;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="n">indmom</span> <span class="o">=</span> <span class="p">(</span><span class="n">returns</span>
          <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
          <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
          <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata</span><span class="p">[[</span><span class="s1">&#39;sector&#39;</span><span class="p">]])</span>
          <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
          <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">indmom</span><span class="p">)</span>
          <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;ticker&#39;</span><span class="p">])</span>
          <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;indmom&#39;</span><span class="p">]])</span>
<span class="n">indmom</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/indmom&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Industry</span> <span class="pre">Momentum</span></code>은 주식의 모멘텀을 측정하는 방법 중 하나로, 특정 산업 부문 내의 주식들의 수익률을 바탕으로 그 산업의 전반적인 모멘텀을 평가합니다. 위의 코드 예제에서는 12개월 동안의 주식의 수익률을 계산하여 주간 빈도로 리샘플링하고, 각 산업 부문별로 이를 그룹화하여 평균 수익률을 계산하는 과정을 보여줍니다.</p>
<p>구체적으로 설명하면, 먼저 <code class="docutils literal notranslate"><span class="pre">close.pct_change(12*MONTH)</span></code>을 사용하여 최근 12개월간의 주식의 월별 수익률을 계산합니다. <code class="docutils literal notranslate"><span class="pre">.resample('W-FRI').last()</span></code>를 사용하여 이 데이터를 주간 빈도로 리샘플링하고, 각 주의 마지막 영업일의 데이터를 가져옵니다. 그런 다음 ``.stack()<code class="docutils literal notranslate"><span class="pre">을</span> <span class="pre">사용하여</span> <span class="pre">데이터를</span> <span class="pre">재구조화하고,</span> </code>.to_frame(‘close’)`를 사용하여 데이터 프레임을 생성합니다.</p>
<p>산업 정보가 포함된 메타데이터와 이 데이터 프레임을 조인한 후, <code class="docutils literal notranslate"><span class="pre">.groupby(['date',</span> <span class="pre">'sector']).close.mean()</span></code>을 사용하여 각 날짜와 산업 부문별로 평균 수익률을 계산합니다. 이렇게 계산된 산업 모멘텀 데이터는 주식의 수익률 데이터와 함께 사용되어, 특정 주식의 모멘텀이 그 주식이 속한 산업 부문의 전반적인 모멘텀과 어떻게 관련되어 있는지를 분석하는 데 사용될 수 있습니다.</p>
<p>이러한 <code class="docutils literal notranslate"><span class="pre">Industry</span> <span class="pre">Momentum</span></code>은 특정 산업 부문의 전반적인 트렌드를 파악하고, 이를 바탕으로 투자 결정을 내리는 데 유용할 수 있습니다.</p>
</section>
<section id="recent-max-return">
<h4>Recent Max Return<a class="headerlink" href="#recent-max-return" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Max daily returns from calendar month t-1</span>
<span class="n">maxret</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span>
           <span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="n">MONTH</span><span class="p">)</span>
           <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
           <span class="o">.</span><span class="n">max</span><span class="p">()</span>
           <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
           <span class="o">.</span><span class="n">last</span><span class="p">()</span>
           <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
           <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;maxret&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">maxret</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/maxret&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Recent</span> <span class="pre">Max</span> <span class="pre">Return</span></code>은 과거 한 달 동안의 일일 최대 수익률을 계산하여 주식의 투자 가치를 평가하는 방법입니다.</p>
<p>코드를 따라가보면, <code class="docutils literal notranslate"><span class="pre">close.pct_change(periods=MONTH)</span></code>을 사용하여 일일 수익률을 계산합니다. 그런 다음, <code class="docutils literal notranslate"><span class="pre">.rolling(21).max()</span></code>를 사용하여 이 수익률의 21일 롤링 윈도우 내에서 최대값을 찾습니다. 이는 과거 한 달 동안의 최대 일일 수익률을 식별하는 데 도움이 됩니다. <code class="docutils literal notranslate"><span class="pre">.resample('W-FRI').last()</span></code>는 데이터를 주간 빈도로 리샘플링하고 각 주의 마지막 데이터를 가져옵니다. <code class="docutils literal notranslate"><span class="pre">.stack().to_frame('maxret')</span></code>는 이 데이터를 재구조화하고 데이터 프레임을 생성합니다.</p>
<p>이러한 최대 일일 수익률 데이터는 주식의 변동성과 리스크를 평가하는 데 사용될 수 있습니다. 높은 최대 일일 수익률은 주식의 높은 변동성을 나타낼 수 있으며, 이러한 정보는 투자자가 리스크 톨러런스와 투자 전략에 맞게 포트폴리오를 구성하는 데 도움이 될 수 있습니다.</p>
</section>
<section id="long-term-reversal">
<h4>Long-Term Reversal<a class="headerlink" href="#long-term-reversal" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cumulative returns months t-36 to t-13.</span>
<span class="n">mom36m</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span>
           <span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">24</span><span class="o">*</span><span class="n">MONTH</span><span class="p">)</span>
           <span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">MONTH</span><span class="p">)</span>
           <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
           <span class="o">.</span><span class="n">last</span><span class="p">()</span>
           <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
           <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;mom36m&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">mom36m</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/mom36m&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Long-Term</span> <span class="pre">Reversal</span></code>은 자산 가격이 장기적으로 과대평가 또는 과소평가된 후에 이전의 평균 가격으로 회귀하는 경향을 바탕으로 합니다. 이 전략에서 <code class="docutils literal notranslate"><span class="pre">Cumulative</span> <span class="pre">returns</span> <span class="pre">months</span> <span class="pre">t-36</span> <span class="pre">to</span> <span class="pre">t-13</span></code>은 과거 36개월부터 13개월 전까지의 누적 수익률을 의미합니다. 이러한 수익률의 데이터를 분석하여 과거에 과대평가되었던 자산이 시간이 지남에 따라 가치를 잃거나, 과소평가되었던 자산이 가치를 회복하는 경향을 찾아내려고 합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">Long-Term</span> <span class="pre">Reversal</span></code>은 주로 행동 금융학에 기반을 두고 있으며, 투자자의 과잉 반응이나 심리적 편향이 시장에서 가격 왜곡을 일으키는 원인이라고 보는 견해를 반영합니다. 이런 가격 왜곡은 시간이 지남에 따라 교정되며, 이 과정에서 투자 기회가 발생합니다. 따라서 <code class="docutils literal notranslate"><span class="pre">Long-Term</span> <span class="pre">Reversal</span></code> 전략을 사용하는 투자자는 이러한 가격 왜곡을 인식하고, 장기적인 시계에서 자산 가격이 평균으로 회귀하는 것을 예측하여 그에 따라 자산을 매입 또는 매수합니다.</p>
</section>
</section>
<section id="liquidity-metrics">
<h3>Liquidity Metrics<a class="headerlink" href="#liquidity-metrics" title="Permalink to this heading">#</a></h3>
<section id="turnover">
<h4>Turnover<a class="headerlink" href="#turnover" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Avg. monthly trading volume for most recent three months scaled by number</span>
<span class="c1"># of shares; we are using the most recent no of shares from yahoo finance</span>
<span class="n">turn</span> <span class="o">=</span> <span class="p">(</span><span class="n">volume</span>
        <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">MONTH</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">last</span><span class="p">()</span>
        <span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">sharesoutstanding</span><span class="p">)</span>
        <span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;ticker&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;turn&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">turn</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/turn&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Turnover</span></code> 팩터는 주식의 거래 활동을 측정하는 지표로, 최근 세 달 동안의 평균 월별 거래량을 주식의 총 주식 수로 나누어 계산됩니다. 위의 코드 예시에서는, 먼저 <code class="docutils literal notranslate"><span class="pre">volume.rolling(3*MONTH).mean()</span></code>를 사용하여 최근 3개월 동안의 평균 월별 거래량을 롤링 윈도우를 사용해 계산합니다. 그런 다음, <code class="docutils literal notranslate"><span class="pre">.resample('W-FRI').last()</span></code>를 사용하여 주간 데이터로 리샘플링하고, 각 주의 마지막 거래일의 거래량 데이터를 가져옵니다.</p>
<p>이후에, <code class="docutils literal notranslate"><span class="pre">.div(metadata.sharesoutstanding)</span></code>를 사용하여 이 거래량을 주식의 총 발행 주식 수로 나누어 주식의 <code class="docutils literal notranslate"><span class="pre">turnover</span></code>를 계산합니다. <code class="docutils literal notranslate"><span class="pre">.stack('ticker').to_frame('turn')</span></code>은 계산된 <code class="docutils literal notranslate"><span class="pre">turnover</span></code> 데이터를 재구조화하고 데이터 프레임으로 변환합니다. 마지막으로, 이 데이터 프레임은 HDF5 파일로 저장됩니다.</p>
<p>이 <code class="docutils literal notranslate"><span class="pre">Turnover</span></code> 팩터는 주식의 유동성, 거래 활동의 활발함, 및 투자자들의 관심을 측정하는 데 사용될 수 있습니다. 높은 <code class="docutils literal notranslate"><span class="pre">turnover</span></code>는 주식이 자주 거래되고 있음을 나타내며, 이는 해당 주식에 대한 투자자들의 높은 관심 또는 시장의 활발한 거래 활동을 반영할 수 있습니다.</p>
</section>
<section id="turnover-volatility">
<h4>Turnover Volatility<a class="headerlink" href="#turnover-volatility" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># onthly std dev of daily share turnover</span>
<span class="n">turn_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">prices</span>
            <span class="o">.</span><span class="n">volume</span>
            <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;ticker&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">sharesoutstanding</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span>
            <span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s1">&#39;ticker&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;turn_std&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">turn_std</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/turn_std&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Turnover</span> <span class="pre">Volatility</span></code> 팩터는 주식의 일일 거래량 변동성을 측정합니다. 주어진 코드는 주식의 일일 거래량을 해당 주식의 총 발행 주식 수로 나눈 후, 이 값을 기반으로 월별 표준 편차를 계산하여 주식의 거래량 변동성을 평가합니다.</p>
<p>코드의 구체적인 동작은 다음과 같습니다:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prices.volume.unstack('ticker')</span></code>를 사용하여 각 티커에 대한 거래량 데이터를 얻습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.div(metadata.sharesoutstanding)</span></code>를 사용하여 거래량을 주식의 총 발행 주식 수로 나눠, 일일 턴오버를 계산합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.rolling(MONTH).std()</span></code>로 최근 한 달간의 일일 턴오버의 표준 편차를 계산하여 거래량 변동성을 측정합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.resample('W-FRI').last()</span></code>로 주간 데이터로 리샘플링하고 각 주의 마지막 데이터를 선택합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.stack('ticker').to_frame('turn_std')</span></code>로 데이터를 재구조화하고 <code class="docutils literal notranslate"><span class="pre">turn_std</span></code>라는 이름의 데이터 프레임으로 변환합니다.</p></li>
</ol>
<p>이 <code class="docutils literal notranslate"><span class="pre">Turnover</span> <span class="pre">Volatility</span></code> 팩터는 주식의 거래 활동의 안정성과 변동성을 평가하는 데 사용됩니다. 높은 거래량 변동성은 시장의 불확실성이나 주식에 대한 투자자의 변덕을 반영할 수 있으며, 낮은 거래량 변동성은 상대적으로 안정적인 투자 환경을 나타낼 수 있습니다. 이러한 정보는 투자자가 리스크를 관리하고 포트폴리오를 최적화하는 데 도움이 될 수 있습니다.</p>
</section>
<section id="log-market-equity">
<h4>Log Market Equity<a class="headerlink" href="#log-market-equity" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Natural log of market cap at end of month t-1</span>
<span class="n">last_price</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
<span class="n">factor</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">last_price</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">mvel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">factor</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">marketcap</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">())</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;mvel&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="n">mvel</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/mvel&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Log</span> <span class="pre">Market</span> <span class="pre">Equity</span></code> 팩터는 각 주식의 시가 총액의 자연 로그를 계산합니다. 주어진 코드에서 <code class="docutils literal notranslate"><span class="pre">close.ffill()</span></code>을 사용하여 결측값을 앞선 값으로 채워넣고, 각 주식의 마지막 가격으로 나누어 주가를 정규화합니다. 그런 다음 <code class="docutils literal notranslate"><span class="pre">metadata.marketcap</span></code>을 사용해 각 주식의 시가 총액을 곱하고, <code class="docutils literal notranslate"><span class="pre">np.log1p()</span></code> 함수를 사용하여 자연 로그를 계산합니다. 결과적으로, 이 팩터는 각 주식의 시가 총액의 크기와 변동을 측정하고, 이를 바탕으로 주식의 상대적인 가치와 리스크를 평가하는 데 사용됩니다.</p>
</section>
<section id="krw-volume">
<h4>KRW Volume<a class="headerlink" href="#krw-volume" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Natural log of trading volume time price per share from month t-2</span>
<span class="n">dv</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
<span class="n">krwvol</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">dv</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                  <span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">last</span><span class="p">())</span>
          <span class="o">.</span><span class="n">stack</span><span class="p">()</span> <span class="c1"># type: ignore</span>
          <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;krwvol&#39;</span><span class="p">))</span>
<span class="n">krwvol</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/krwvol&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">KRW</span> <span class="pre">Volume</span></code> 팩터는 거래량과 주가를 곱하여 거래 대금을 계산한 뒤, 이 값을 자연 로그로 변환합니다. 코드에서는 <code class="docutils literal notranslate"><span class="pre">close.mul(volume)</span></code>을 사용하여 거래 대금을 계산하고, <code class="docutils literal notranslate"><span class="pre">rolling(21).mean().shift(21)</span></code>을 사용하여 과거 21일 동안의 평균 거래 대금을 계산한 후, 이를 한 달 지연시킵니다. 이 팩터는 주식의 거래 활동과 유동성을 측정하는 데 사용됩니다. 높은 <code class="docutils literal notranslate"><span class="pre">KRW</span> <span class="pre">Volume</span></code> 값은 높은 거래 활동과 유동성을 나타내며, 주식의 가격 변동성이 높을 수 있음을 의미할 수 있습니다.</p>
</section>
<section id="amihud-illiquidity">
<h4>Amihud Illiquidity<a class="headerlink" href="#amihud-illiquidity" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Average of daily (absolute return / dollar volume)</span>
<span class="n">ill</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
       <span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
       <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
       <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
       <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
       <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
       <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;ill&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">ill</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/ill&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Amihud</span> <span class="pre">Illiquidity</span></code> 팩터는 주식의 일일 절대 수익률을 일일 거래 대금으로 나누어 주식의 유동성을 측정합니다. 주어진 코드에서 <code class="docutils literal notranslate"><span class="pre">close.pct_change().abs().div(dv)</span></code>를 사용하여 각 주식의 절대 수익률을 거래 대금으로 나눕니다. 그런 다음, <code class="docutils literal notranslate"><span class="pre">rolling(21).mean()</span></code>을 사용하여 과거 21일 동안의 평균 유동성을 계산합니다. 낮은 <code class="docutils literal notranslate"><span class="pre">Amihud</span> <span class="pre">Illiquidity</span></code> 값은 주식이 높은 유동성을 가지고 있음을 나타내며, 높은 값은 낮은 유동성, 즉 주식을 매매할 때 높은 비용이 발생할 수 있음을 의미합니다.</p>
</section>
</section>
<section id="risk-measures">
<h3>Risk Measures<a class="headerlink" href="#risk-measures" title="Permalink to this heading">#</a></h3>
<section id="return-volatility">
<h4>Return Volatility<a class="headerlink" href="#return-volatility" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard dev of daily returns from month t-1.</span>
<span class="n">retvol</span> <span class="o">=</span> <span class="p">(</span><span class="n">close</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
          <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
          <span class="o">.</span><span class="n">std</span><span class="p">()</span>
          <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">last</span><span class="p">()</span>
          <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
          <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;retvol&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">retvol</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/retvol&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Return</span> <span class="pre">Volatility</span></code> 팩터는 과거 한 달 동안의 주식의 일일 수익률의 표준 편차를 계산하여 주식의 가격 변동성을 측정합니다. <code class="docutils literal notranslate"><span class="pre">close.pct_change()</span></code>을 사용하여 일일 수익률을 계산하고, <code class="docutils literal notranslate"><span class="pre">rolling(21).std()</span></code>로 그 21일 동안의 표준 편차를 계산합니다. 높은 변동성 값은 주식의 가격이 더 불안정하고 변동이 크다는 것을 나타내며, 이는 높은 리스크, 또는 투자 기회를 의미할 수 있습니다. 이 팩터는 주로 리스크 관리 및 투자 전략 개발에 사용됩니다.</p>
</section>
<section id="market-beta">
<h4>Market Beta<a class="headerlink" href="#market-beta" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimated market beta from weekly returns and equal weighted market returns</span>
<span class="c1"># for 3 years ending month t-1 with at least 52 weeks of returns.</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">close</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-FRI&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_market_beta</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">RollingOLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> 
                       <span class="n">exog</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">]]),</span>
                      <span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="mi">52</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">params_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="c1"># type: ignore</span>

<span class="c1"># 20초</span>
<span class="n">beta</span> <span class="o">=</span> <span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="mi">52</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_market_beta</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">))</span> <span class="c1"># type: ignore</span>
<span class="n">beta</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/beta&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Market</span> <span class="pre">Beta</span></code> 팩터는 주식의 주간 수익률에 대한 시장 베타를 계산합니다. 시장 베타는 주식의 수익률이 전체 시장의 수익률에 얼마나 민감하게 반응하는지를 측정하는 지표입니다. 코드에서 <code class="docutils literal notranslate"><span class="pre">close.resample('W-FRI').last().pct_change().mean(1)</span></code>를 사용하여 동일 가중치로 시장 수익률을 계산하고, <code class="docutils literal notranslate"><span class="pre">RollingOLS</span></code> 모델을 사용하여 주식의 주간 수익률에 대한 시장 베타를 롤링 윈도우 기반으로 추정합니다.</p>
<p>높은 베타 값은 주식이 시장 변동에 민감하게 반응한다는 것을 나타내며, 낮은 베타 값은 주식이 시장 변동에 상대적으로 둔감하다는 것을 의미합니다. 베타는 투자자들이 주식 포트폴리오의 시스테믹 리스크를 평가하고, 리스크를 관리하는 데 사용되는 중요한 지표입니다.</p>
</section>
<section id="beta-squared">
<h4>Beta Squared<a class="headerlink" href="#beta-squared" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Market beta squared</span>
<span class="n">betasq</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;betasq&#39;</span><span class="p">)</span>
<span class="n">betasq</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/betasq&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Beta</span> <span class="pre">Squared</span></code> 팩터는 <code class="docutils literal notranslate"><span class="pre">Market</span> <span class="pre">Beta</span></code>의 제곱값을 나타냅니다. <code class="docutils literal notranslate"><span class="pre">Market</span> <span class="pre">Beta</span></code>는 주식의 수익률이 전체 시장의 수익률에 얼마나 민감하게 반응하는지를 측정하는 지표입니다. 따라서, <code class="docutils literal notranslate"><span class="pre">Beta</span> <span class="pre">Squared</span></code>는 이 민감도의 강도를 제곱하여 더욱 확대해서 보여줍니다.</p>
</section>
<section id="idiosyncratic-return-volatility">
<h4>Idiosyncratic return volatility<a class="headerlink" href="#idiosyncratic-return-volatility" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard dev of a regression of residuals of weekly returns</span>
<span class="c1"># on the returns of an equal weighted market index returns for the prior three years.</span>
<span class="k">def</span> <span class="nf">get_ols_residuals</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">]]))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># 오래 걸림</span>
<span class="n">idiovol</span> <span class="o">=</span> <span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">52</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_ols_residuals</span><span class="p">)))</span>
<span class="n">idiovol</span> <span class="o">=</span> <span class="n">idiovol</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;idiovol&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<span class="n">idiovol</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">results_path</span> <span class="o">/</span> <span class="s1">&#39;autoencoder.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;factor/idiovol&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Idiosyncratic</span> <span class="pre">Return</span> <span class="pre">Volatility</span></code> 팩터는 주식의 특이한 또는 고유한 수익률 변동성을 나타냅니다. 이는 시장 지수의 변동성으로 설명되지 않는 주식의 변동성을 측정합니다. 이러한 고유 변동성은 주식의 기업 특정 리스크나 뉴스, 이벤트 등에 의해 영향을 받을 수 있습니다.</p>
<p>주어진 코드의 작동 방식은 다음과 같습니다:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>를 사용하여 동일 가중치의 시장 지수 수익률을 가져옵니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_ols_residuals</span></code> 함수 내에서, 각 주식의 주간 수익률과 시장 지수 수익률을 회귀 분석하여 고유한 <strong>(idiosyncratic)</strong> 리스크를 추출합니다. 이는 시장 지수 수익률의 영향을 배제하고 주식의 고유한 수익률 변동성만을 측정합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x.rolling(3</span> <span class="pre">*</span> <span class="pre">52).apply(get_ols_residuals)</span></code>을 사용하여 주식의 고유한 수익률 변동성을 롤링 윈도우 기반으로 계산합니다. 여기서 <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">*</span> <span class="pre">52</span></code>는 과거 3년간의 주간 데이터를 사용함을 의미합니다.</p></li>
</ol>
<p>결과적으로 <code class="docutils literal notranslate"><span class="pre">Idiosyncratic</span> <span class="pre">Return</span> <span class="pre">Volatility</span></code> 팩터는 주식이나 포트폴리오의 고유한 리스크를 평가하는 데 사용됩니다. 이 팩터가 높으면 주식의 가격이 기업 또는 산업 특정 이벤트에 더 민감하게 반응할 가능성이 높아, 리스크가 높아질 수 있습니다. 반대로, 이 팩터가 낮으면 주식의 가격은 상대적으로 안정적일 것입니다. 이 정보는 투자자가 포트폴리오의 고유한 리스크를 관리하고, 다각화 전략을 개발하는 데 도움이 될 수 있습니다.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="4.build_stock_dataset.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Code Review #1 - Build Stock Dataset</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1. 데이터 불러오기</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prices-metadata">Prices, Metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#select-tickers-with-metadata">Select tickers with metadata</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-engineering">Factor Engineering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#price-trend">Price Trend</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#short-term-reversal">Short-Term Reversal</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-momentum">Stock Momentum</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#momentum-change">Momentum Change</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#industry-momentum">Industry Momentum</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recent-max-return">Recent Max Return</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#long-term-reversal">Long-Term Reversal</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#liquidity-metrics">Liquidity Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#turnover">Turnover</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#turnover-volatility">Turnover Volatility</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-market-equity">Log Market Equity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#krw-volume">KRW Volume</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#amihud-illiquidity">Amihud Illiquidity</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-measures">Risk Measures</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#return-volatility">Return Volatility</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#market-beta">Market Beta</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#beta-squared">Beta Squared</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#idiosyncratic-return-volatility">Idiosyncratic return volatility</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By INYEOL CHOI
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>